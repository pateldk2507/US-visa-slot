chrome.runtime.onInstalled.addListener(({reason:s})=>{chrome.storage.local.get(["is_display-slots","is_sel-1st-slot","is_auto-login"],function(e){chrome.storage.local.set({extVersion:chrome.runtime.getManifest()["version"],"is_display-slots":e["is_display-slots"]||false,"is_sel-1st-slot":e["is_sel-1st-slot"]||false,"is_auto-login":e["is_auto-login"]||false},function(){if(s==="install")chrome.tabs.create({url:"options.html"})})});const e=[{id:"usvisascheduling",js:["js/page.js"],matches:["https://www.usvisascheduling.com/en-US/*schedule/*"],runAt:"document_start",world:"MAIN"}];chrome.scripting.registerContentScripts(e)["catch"](console.log)});chrome.runtime.onMessageExternal.addListener((e,s,t)=>{if(e){if(e.message){if(e.message==="version"){t({version:chrome.runtime.getManifest()["version"]})}}else if(e.apiKey){chrome.storage.local({apiKey:e.apiKey})}}return true});chrome.action.onClicked.addListener(t=>{if(t.url.includes("usvisascheduling")){return 1}chrome.tabs.sendMessage(t.id,"toggle",e=>{let s=chrome.runtime.lastError;if(s&&!e||true){chrome.scripting.insertCSS({target:{tabId:t.id},files:["css/content.css"]},()=>{let e=chrome.runtime.lastError;if(!e){chrome.scripting.executeScript({target:{tabId:t.id},files:["js/content2.js"]})}else{console.log(e.message)}})}})});chrome.runtime.onMessage.addListener((u,e,s)=>{if(u.action==="getApntConfDets"){const t=async()=>{const e=await i();s({apntConfDets:e})};t();return true}else{chrome.storage.local.get(["apiKey","userProfiles","extVersion","sn_uid_valid"],function(e){let s=u.slot_page,t=JSON.parse(e["userProfiles"])[u.portal_id],[i,a]=u.imgUri.split(","),[n,r]=/data:(.*);base64/.exec(i),o=atob(a),l=Array.from({length:o.length}).map((e,s)=>o.charCodeAt(s)),c=g(),p=new FormData;p.append("input",new Blob([new Uint8Array(l)],{type:"image/png"}),c);if(t.hasOwnProperty("VisaClass")){let e={VisaClass:t["VisaClass"]};if(t.hasOwnProperty("VisaClassID")){e["VisaClassID"]=t["VisaClassID"]}if(t.hasOwnProperty("visaPriority")){e["visaPriority"]=t["visaPriority"]}p.append("visaDetails",JSON.stringify(e))}else{p.append("visaDetails",t["visaDetails"])}p.append("userDetails",t["userDetails"]);p.append("apntDetails",t["apntDetails"]);p.append("familyDetails",t["familyDetails"]);p.append("slotDetails",JSON.stringify(s["slotDetails"]));p.append("slotPageUsername",s["slotPageUsername"]);p.append("appointmentTimes",JSON.stringify(s["appointmentTimes"]));if(s.hasOwnProperty("slotdetails")&&e["sn_uid_valid"]){p.append("slotdetails",btoa(JSON.stringify(m(s["slotdetails"])).replaceAll("T00:00:00","")))}const d={headers:{"x-api-key":e["apiKey"],extVersion:e["extVersion"]},method:"POST",body:p};fetch("https://app.checkvisaslots.com"+u.resource,d).then()["catch"](e=>{console.log(e)})})}});function g(){let e=new Date;let s=e.toISOString();let t=s.replaceAll(":",".").substring(0,s.lastIndexOf("."));return`${t}.png`}function m(e){if(!e.length)return{};return e.reduce((e,s)=>(e[s.ID]=s.Date,e),{})}function i(){return fetch("https://www.usvisascheduling.com/en-US/appointment-confirmation/").then(e=>e.text()).then(e=>{return e})}