const o={year:24*60*60*1e3*365,month:24*60*60*1e3*365/12,day:24*60*60*1e3,hour:60*60*1e3,minute:60*1e3,second:1e3},n=new Intl.RelativeTimeFormat("en",{numeric:"auto"});let d=(e,t=new Date)=>{return u(new Date(e)-t)};function u(t){for(let e in o)if(Math.abs(t)>o[e]||e==="second")return{rel_time_str:n.format(Math.round(t/o[e]),e),rel_secs:parseInt(t/1e3)*-1}}let a=Object.fromEntries(new URLSearchParams(window.location.search));async function l(){document.getElementById("submit").style.display="none";document.getElementById("apiKey").disabled=true;document.getElementById("apiKey").type="password";document.getElementById("edit").style.display="inline"}chrome.storage.local.get("apiKey",e=>{let t=document.getElementById("apiKey");t.value=e.apiKey??"";if(t.value){l();document.getElementById("submit").click()}});document.getElementById("submit").onclick=function(){document.querySelectorAll(".no-popup-show").forEach(e=>e.style.display="none");chrome.storage.local.get(["valDated","apiKey"],function(e){let t=e.valDated===(new Date).toDateString()&&document.getElementById("apiKey").value===e.apiKey;s(t).then(e=>{if(!e){l()}else if(e.ok){document.querySelectorAll(".no-popup-show").forEach(e=>e.style.display="inherit");if(e.slotPrefs){document.querySelector("#slotPrefs").style.display="block"}l();if(a.from==="page"){document.querySelector(".refresh-slots").click()}else{r();i();m()}}})})};document.getElementById("edit").onclick=function y(){document.getElementById("edit").style.display="none";let e=document.getElementById("redirect_link");e.style.display="none";e.href="https://checkvisaslots.com/last-us-visa-availability.html?utm_source=chr_ext";document.getElementById("apiKey").disabled=false;document.getElementById("apiKey").type="text";document.getElementById("submit").style.display="inline"};document.querySelector(".refresh-slots").onclick=function e(){this.disabled=true;this.innerText="🕑";const t=5;let n,c="https://www.usvisascheduling.com/en-US/";chrome.storage.local.get(["cvs_txn_latest","apiKey","prevSlotsInfo"],async function(o){n=t-parseInt((Date.now()-parseInt(o["cvs_txn_latest"]))/1e3);if(n>0){document.querySelector(".section-server-alert").style.display="-webkit-box";document.getElementById("server_msg").innerHTML=`You may not see availability changes with in ${t} seconds. Try after ${n} seconds`;document.getElementById("tip_msg").parentElement.parentElement.style.display="none";document.querySelector("#slots-info").innerHTML=o["prevSlotsInfo"]}else{document.querySelector(".section-server-alert").style.display="none";try{let e={headers:{"x-api-key":o["apiKey"],extVersion:chrome.runtime.getManifest().version}},t=await fetch("https://app.checkvisaslots.com/slots/v3",e);let r=await t.json();if(t.status!==200){document.getElementById("server_msg").innerHTML=r.message;document.querySelector(".section-server-alert").style.display="-webkit-box";document.querySelectorAll(".section-slots-info").forEach(e=>e.style.display="none")}else{const i={};chrome.storage.local.set({cvs_txn_latest:Date.now().toString(),valDated:(new Date).toDateString()});document.getElementById("visa-info").innerHTML=`${r.userDetails.visa_type} (${r.userDetails.appointment_type})`;let n="<table class='table table-bordered table-striped table-hover'><tr><th>Visa Location</th><th title='No. of available dates'>Dates#<p class='p-0 m-0 small border-top' title='Only for Premium Users'>Start Date*</p></th><th>Checked</th></tr>",l=0,s=r.userDetails.appointment_type,a=[];for(let o of r.slotDetails){let e=d(o.createdon);let t=`<p class='p-0 m-0'> ${o.slots}</p>`;if(o&&o.start_date){t+=`<p class='p-0 m-0 small border-top'> ${o.start_date}</p>`}else if(o.slots>0){t+=`<p class='p-0 m-0 small border-top'><a rel='noreferrer' target="_blank" href="https://checkvisaslots.com/index.html#pricing" title="Buy Premium">Start Date</a></p>`}n+=`<tr><td>${o.visa_location}</td><td>`+t+`</td><td>${e.rel_time_str}</td></tr>`;if(s==="Dropbox"){l+=o.slots;a.push(e.rel_secs)}else if(!o.visa_location.includes("VAC")){a.push(e.rel_secs);l+=o.slots}}n+="</table>";document.querySelector("#slots-info").innerHTML=n;chrome.storage.local.set({prevSlotsInfo:n});let e=new Intl.DateTimeFormat("en-US",{dateStyle:"medium",timeStyle:"long"}).format(new Date);document.querySelector("#refreshed-info").innerHTML=`<i>Retrieved at ${e}</i>`;let o="<b>Tip: </b>";if("tipMessage"in r){o+=r["tipMessage"]}else{if(l===0){if(!a.length){a=[3600]}let e=u(Math.min(...a)*-1*1e3).rel_time_str;o+="No slots were available "+e;if(Math.min(...a)<=2*60){o+=". No need to Login CGI portal"}else if(Math.min(...a)<5*60){o+=". Its been sometime, try your luck; "+`<a href=${c} rel="noreferrer" target="_blank">Login CGI portal</a>`}else if(Math.min(...a)>5*60){o+=". That's a long gap & things might have changed. Consider "+`<a href=${c} rel="noreferrer" target="_blank">logging in CGI portal</a>`}}else if(l>=5){for(let t of r.slotDetails){let e=d(t.createdon);if(e.rel_secs<=2*60){o="Very High chance slots are available 😍 GO "+`<a href=${c} rel="noreferrer" target="_blank">BOOK IT</a>.`;break}else if(2*60<e.rel_secs<3*60){o="Medium chance. There were slots "+e.rel_time_str+". Rush Rush !! "+`<a href=${c} rel="noreferrer" target="_blank">CGI Login</a>`}}}}if(o){document.getElementById("tip_msg").innerHTML=o}}}catch(e){console.log(e)}}});this.disabled=false;this.innerText="🔄"};if(a.from==="page"){document.querySelector(".tile-2-invalid").classList.add("d-none");document.querySelector("#chrome-rating").style.display="inherit";document.querySelector("#google-award").style.display="none"}else{document.body.classList.remove("from-page");document.querySelector(".main-view").classList.remove("no-border");document.querySelector(".section-slots-info").style.display="none";document.querySelector("#chrome-rating").style.display="none";document.querySelector("#google-award").style.display="inherit"}async function s(e=false){let t=document.getElementById("apiKey").value,o=e,n={headers:{"x-api-key":t,extVersion:chrome.runtime.getManifest().version}},l={},s;if(!t||t.length<6){l.ok=false;document.getElementById("server_msg").innerHTML="Enter a Valid Access Code";document.querySelector(".section-server-alert").style.display="-webkit-box";return l}else if(!o&&t){l=await fetch("https://app.checkvisaslots.com/validate/v3",n);s=await l.json();o=l.status===200}else if(o){l.ok=true;if(a.from==="page"){document.querySelectorAll(".section-slots-info").forEach(e=>e.style.display="inherit")}else{document.querySelector(".suggest-signup").classList.add("d-none")}}if(!o){l.ok=false;if(t){document.getElementById("server_msg").innerHTML=s.message;document.querySelector(".section-server-alert").style.display="-webkit-box"}document.querySelectorAll(".section-slots-info").forEach(e=>e.style.display="none");document.querySelector(".suggest-signup").classList.remove("d-none");document.getElementById("extension_usage_helper").classList.add("d-none");await chrome.storage.local.remove("apiKey")}else{l.ok=true;if(a.from!=="page"){document.getElementById("server_msg").innerHTML="✅ Activated ✅";document.querySelector(".section-server-alert").style.display="-webkit-box"}await chrome.storage.local.set({apiKey:t,valDated:(new Date).toDateString(),appointment_type:s&&s.appointment_type,visa_type:s&&s.visa_type,sn_uid_valid:s&&s.sn_uid_valid},function(){if(a.from==="page"){document.querySelectorAll(".section-slots-info").forEach(e=>e.style.display="inherit")}else{document.querySelector(".suggest-signup").classList.add("d-none");document.getElementById("extension_usage_helper").classList.remove("d-none")}let e=document.getElementById("redirect_link");e.style.display="inline";e.href="https://checkvisaslots.com/latest-us-visa-availability.html?utm_source=chr_ext"})}return l}document.querySelectorAll(".custom-control-input").forEach(e=>e.addEventListener("change",function(){let e=this.id,t=this.checked,o=e.replace("-btn",""),n={};n[o]=t;chrome.storage.local.set(n,function(){})}));chrome.storage.local.get(["is_sel-1st-slot","is_display-slots","is_auto-login"],function(e){document.getElementById("is_sel-1st-slot-btn").checked=e["is_sel-1st-slot"];document.getElementById("is_display-slots-btn").checked=e["is_display-slots"];document.getElementById("is_auto-login-btn").checked=e["is_auto-login"];if(!a.from&&e["is_auto-login"]){t()}});document.getElementById("is_auto-login-btn").addEventListener("change",function(){document.querySelectorAll(".auto-login-container").forEach(e=>e.style.display=this.checked?"flex":"none");if(this.checked){t()}});async function r(){let e=document.getElementsByClassName("qna").length;if(e===3)return;let t=`<div class="qna">
            <div class="row">
                <label class="col-1 col-form-label" for="question">Q${e+1}</label>
                <select class="form-control col-11 custom-select-sm question">
                    <option value="">-- Select a question --</option>
                    <option value="Where did you meet your spouse?">Where did you meet your spouse?</option>
                    <option value="What is your sibling's middle name?">What is your sibling's middle name?</option>
                    <option value="Who was your childhood hero?">Who was your childhood hero?</option>
                    <option value="In what city or town was your first job?">In what city or town was your first job?</option>
                    <option value="What is the name of a college you applied to but didn’t attend?">What is the name of a college you applied to but didn’t attend?</option>
                    <option value="What is the name of the road/street you grew up on?">What is the name of the road/street you grew up on?</option>
                    <option value="What is your least favorite food?">What is your least favorite food?</option>
                    <option value="What was the first company that you worked for?">What was the first company that you worked for?</option>
                    <option value="What is your favorite food?">What is your favorite food?</option>
                    <option value="What high school did you attend?">What high school did you attend?</option>
                    <option value="What is your mother's maiden name?">What is your mother's maiden name?</option>
                    <option value="What was the name of your first/current/favorite pet?">What was the name of your first/current/favorite pet?</option>
                    <option value="What was your first car?">What was your first car?</option>
                    <option value="What elementary school did you attend?">What elementary school did you attend?</option>
                    <option value="What is the name of the town/city where you were born?">What is the name of the town/city where you were born?</option>
                </select>
                <div class="form-group form-control-sm form-inline" style="padding-left: 16px">
                    <label for="answer">Ans:</label>
                    <input type="text" class="form-control answer form-control-sm" name="answer" required></input>
                </div>
            </div>
        </div>`;let o=document.createElement("div");o.innerHTML=t;document.querySelector("#security-questions").appendChild(o.firstChild);r()}function i(){let t={ofc:["CHENNAI VAC","HYDERABAD VAC","KOLKATA VAC","MUMBAI VAC","NEW DELHI VAC"],ca:["CHENNAI","HYDERABAD","KOLKATA","MUMBAI","NEW DELHI"]};function o(o){let e=t[o];let n=e.map(e=>`<option value="${e}">${e}</option>`).join("\n");n=`<option value="">NONE</option>`+n;document.getElementById(`preferred-${o}-location-container`).innerHTML="";for(let t=0;t<e.length;t++){let e=`
                <div class="row mb-2 form-inline">
                    <div class="col-4">
                        <label>Priority ${t+1}</label>
                    </div>
                    <div class="col-8 form-group">
                        <select class="form-control">${n}</select>
                    </div>
                </div>
            `;document.querySelector(`#preferred-${o}-location-container`).innerHTML+=e}}o("ofc");document.getElementsByClassName("loc-ca")[0].style.display="none";chrome.storage.local.get(["appointment_type"],function(e){if(e["appointment_type"]!=="Dropbox"){o("ca");document.getElementsByClassName("loc-ca")[0].style.display="block"}})}document.getElementById("save-slot-preferences-btn").addEventListener("click",function(){let e={slot_start_date:document.getElementById("slot-start-date").value,slot_end_date:document.getElementById("slot-end-date").value},t={ofc:[],ca:[]};document.querySelectorAll("#preferred-ofc-location-container select").forEach(e=>t["ofc"].push(e.value));document.querySelectorAll("#preferred-ca-location-container select").forEach(e=>t["ca"].push(e.value));t["ofc"]=t["ofc"].filter((e,t,o)=>e&&o.indexOf(e)===t);t["ca"]=t["ca"].filter((e,t,o)=>e&&o.indexOf(e)===t);chrome.storage.local.set({preferred_locations:t,preferred_window:e,portal_id:document.getElementById("portal-id").value},function(){c("save-slot-preferences-btn")})});async function c(e,t=5){document.getElementById(e).innerHTML="saved";document.getElementById(e).disabled=true;setTimeout(function(){document.getElementById(e).innerHTML="Save";document.getElementById(e).disabled=false},t*1e3)}document.getElementById("save-login-dets-btn").addEventListener("click",function(){let e={username:document.getElementById("cvs-username").value,password:document.getElementById("cvs-password").value};let t={};let o=document.querySelectorAll(".question");let n=document.querySelectorAll(".answer");for(let e=0;e<o.length;e++){t[o[e].value]=n[e].value}chrome.storage.local.set({loginDetails:e,securityQuestions:t},function(){c("save-login-dets-btn",3)})});async function t(){document.querySelectorAll(".auto-login-container").forEach(e=>e.style.display="flex");chrome.storage.local.get(["loginDetails","securityQuestions"],function(e){if(e&&e["loginDetails"]){const t=e["loginDetails"].hasOwnProperty("username")?e["loginDetails"]["username"]:"",o=e["loginDetails"].hasOwnProperty("password")?e["loginDetails"]["password"]:"";document.getElementById("cvs-username").value=t;document.getElementById("cvs-password").value=o}let n=document.querySelectorAll(".question"),l=document.querySelectorAll(".answer");if(e&&e["securityQuestions"]){Object.entries(e["securityQuestions"]).forEach(function([e,t],o){n[o].value=e;l[o].value=t})}})}async function m(){chrome.storage.local.get(["preferred_locations","preferred_window","portal_id"],function(e){document.getElementById("portal-id").value=e["portal_id"];let t=e["preferred_window"];if(t&&t["slot_start_date"]){document.getElementById("slot-start-date").value=t["slot_start_date"];document.getElementById("slot-end-date").value=t["slot_end_date"]}let o=e["preferred_locations"];if(!o||!o["ofc"]){return}for(let e=0;e<o["ofc"].length;e++){document.querySelectorAll("#preferred-ofc-location-container select")[e].value=o["ofc"][e]}if(document.querySelectorAll("#preferred-ca-location-container select").length===0){return}for(let e=0;e<o["ca"].length;e++){document.querySelectorAll("#preferred-ca-location-container select")[e].value=o["ca"][e]}})}